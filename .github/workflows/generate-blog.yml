name: Generate Blog Content

on:
  schedule:
    - cron: "0 */3 * * *" # Run every 3 hours
  workflow_dispatch: # Allow manual triggering for testing

jobs:
  generate-blog:
    runs-on: ubuntu-latest
    steps:
      - name: Generate blogs for all genres
        run: |
          echo "Starting blog generation process..."

          # Base URL and auth token
          API_URL="https://techinsightsai-backend.vercel.app/api/blogs/generate"

          # Generate general blog
          echo "Generating general blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{}')
          echo "General blog response: $RESPONSE"
          sleep 20

          # Generate AI/ML blog
          echo "Generating AI/ML blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"ai-ml"}')
          echo "AI/ML blog response: $RESPONSE"
          sleep 20

          # Generate Cybersecurity blog
          echo "Generating Cybersecurity blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"cybersecurity"}')
          echo "Cybersecurity blog response: $RESPONSE"
          sleep 20

          # Generate Coding blog
          echo "Generating Coding blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"coding"}')
          echo "Coding blog response: $RESPONSE"
          sleep 20

          # Generate Emerging Tech blog
          echo "Generating Emerging Tech blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"emerging-tech"}')
          echo "Emerging Tech blog response: $RESPONSE"
          sleep 20

          # Generate Tech News blog
          echo "Generating Tech News blog..."
          RESPONSE=$(curl -s -X POST "$API_URL" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"tech-news"}')
          echo "Tech News blog response: $RESPONSE"

          echo "All blog generation requests completed at $(date)"
