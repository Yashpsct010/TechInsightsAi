name: Generate Blog Content

on:
  schedule:
    - cron: "0 */1 * * *" # Run every 1 hours
  workflow_dispatch: # Allow manual triggering for testing

jobs:
  general-blog:
    runs-on: ubuntu-latest
    steps:
      - name: Generate general blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{}'
          echo "General blog generation triggered"

  ai-ml-blog:
    runs-on: ubuntu-latest
    needs: general-blog
    steps:
      - name: Wait for previous job
        run: sleep 120
      - name: Generate AI/ML blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"ai-ml"}'
          echo "AI/ML blog generation triggered"

  cybersecurity-blog:
    runs-on: ubuntu-latest
    needs: ai-ml-blog
    steps:
      - name: Wait for previous job
        run: sleep 120
      - name: Generate Cybersecurity blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"cybersecurity"}'
          echo "Cybersecurity blog generation triggered"

  coding-blog:
    runs-on: ubuntu-latest
    needs: cybersecurity-blog
    steps:
      - name: Wait for previous job
        run: sleep 120
      - name: Generate Coding blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"coding"}'
          echo "Coding blog generation triggered"

  emerging-tech-blog:
    runs-on: ubuntu-latest
    needs: coding-blog
    steps:
      - name: Wait for previous job
        run: sleep 120
      - name: Generate Emerging Tech blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"emerging-tech"}'
          echo "Emerging Tech blog generation triggered"

  tech-news-blog:
    runs-on: ubuntu-latest
    needs: emerging-tech-blog
    steps:
      - name: Wait for previous job
        run: sleep 120
      - name: Generate Tech News blog
        run: |
          curl -s -X POST "https://techinsightsai-backend.vercel.app/api/blogs/generate" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -d '{"genre":"tech-news"}'
          echo "Tech News blog generation triggered"
